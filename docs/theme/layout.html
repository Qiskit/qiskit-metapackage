{% extends "!layout.html" %}
{% block extrahead %}
    <script>
    /* Define digital data object based on _appInfo object */
    window.digitalData = {
        page: {
        pageInfo: {
            productTitle: 'IBM Q Experience',
            analytics: {
            category: 'Qiskit.org',
            },
        },
        },
    };
    window._analytics = {
        segment_key: 'ffdYLviQze3kzomaINXNk6NwpY9LlXcw',
        coremetrics: false,
        optimizely: false,
        googleAddServices: false,
        fullStory: false,
        autoPageEventSpa: true,
        autoFormEvents: false,
        autoPageView: true,
        preventPageEvent: true,
    };
    </script>
    <script src="https://cloud.ibm.com/analytics/build/bluemix-analytics.min.js"></script>
    {{ super() }}
    <div class="languages-bottom">
        <span>Select language</span>
        <span class="lang-switch">
            <select id="language" name="languages">
                <option value="en">English</option>
                <option value="ja">Japanese</option>
            </select>
        </span>
    </div>
    <script>
        var localeRegExp = /\/(locale\/([a-z-]+)\/)?/i;
        var prefix = '';
        function getDefaultLanguage() {
            return 'en';
        }
        var el = document.getElementById('language');
        var optionsToSelect = ['en', 'ja']
        function changeLoc(evt) {
        var language = evt.target.options[el.selectedIndex].value;
        var pathname = window.location.pathname.slice(prefix.length);
        if (language === getDefaultLanguage()) {
            window.location.pathname =
            `${prefix}${pathname.replace(localeRegExp, '/')}`;
        } else {
            window.location.pathname =
            `${prefix}${pathname.replace(localeRegExp, `/locale/${language}/`)}`;
        }
        };
        el.addEventListener('change', changeLoc);
        function extractLanguageFromUrl(pathname) {
            const match = pathname.slice(prefix.length).match(localeRegExp);
            return typeof match[2] === 'undefined' ?
                getDefaultLanguage() : match[2];
        }
        function changeSelect(select) {
            const optionToSelect = extractLanguageFromUrl(window.location.pathname);
            for (var i = 0; i < select.options.length; i++) {
                var o = select.options[i];
                if (optionToSelect == o.value) {
                    o.selected = true;
                }
            }
        };
        changeSelect(el);
    </script>
    <script>
        function trackClickEvent (data) {
        if (window.bluemixAnalytics && window.digitalData) {
            var segmentEvent = {
                productTitle: window.digitalData.page.pageInfo.productTitle,
                category: window.digitalData.page.pageInfo.analytics.category,
                url: window.location.href,
                action: window.location.href + ' - Clicked: ' + data.action,
                objectType: data.objectType,
                successFlag: true
            };

            if(data.milestoneName) {
                egmentEvent = Object.assign(segmentEvent, { milestoneName: data.milestoneName });
            }
            window.bluemixAnalytics.trackEvent('Custom Event', segmentEvent);
        }
      };

      function clickExternalLink() {
        trackClickEvent({
            action: "Tutorials Link in Navbar",
            objectType: "Link",
            milestoneName: "Looked at tutorials"
        });
      };
    </script>
{% endblock %}